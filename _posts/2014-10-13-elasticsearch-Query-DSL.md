---
layout: post
title:  "elasticsearch:Query DSL"
date:   2014-10-13 16:36:18
categories: elasticsearch
---

elasticsearch 提供基于JSON的完整的Query DSL查询表达式(DSL即领域专用语言). 

一般来说, 普通的查询如 term 或者 prefix. 另外还有混合查询如 bool 等. 

另外查询表达式(Queries)还能够关联特定的过滤表达式，如 filtered 或者 constant_score 查询.

你可以把Query DSL当作是一系列的抽象的查询表达式树（ AST ）. 

特定查询能够包含其它的查询，(如 bool ), 有些查询能够包含过滤器(如 constant_score), 

还有的可以同时包含查询和过滤器 (如 filtered). 

都能够从ES支持查询集合里面选择任意一个查询或者是从过滤器集合里面挑选出任意一个过滤器, 

这样的话，我们就可以构造出任意复杂（maybe 非常有趣）的查询了，是不是很灵活啊.

查询和过滤都可以被用于各种不同的API接口里面. 如 search query, 或者是 facet filter 等等. 

本章会介绍构造AST能够用到的各种查询或者过滤器.

提示. 过滤器非常有用因为他们比简单的查询更快（不进行文档评分）并且会自动缓存.

过滤器和缓存（Filters and Caching）过滤器是用来实现缓存的很好的办法. 

因为缓存这些过滤结果并不需要太多的内存, 而且其它的查询可以重用这些过滤（注意是同样参数哦），所以速度是刷刷的.

某些过滤产生的结果是很易于缓存的，有关缓存与否的区别在于是否将过滤结果存放到缓存中，

像如下过滤器如 term, terms, prefix, 和 range 默认就是会进行缓存的, 

并且建议使用这些过滤条件而不使用同等效果的查询.


其它过滤器，一般会将字段数据加载到内存中来工作, 默认是不缓存结果的. 

这些过滤操作的速度其实已经非常快了，如果将它们的结果缓存需要做额外的操作来使它们能够被其它查询使用，

这些查询，包括地理位置的（geo）, numeric_range, 和 script 默认是没有缓存结果的.

最后一个过滤器的类型是过滤器之间的组合， and, not 和 or ，

这些过滤器是没有缓存结果的，因为它们主要是操作内联的过滤器，所以不需要过滤.

所有的过滤器都允许设置 _cache 元素来显式的控制缓存与否. 

并且允许设置一个 _cache_key 用来当作缓存的主键. 这个在过滤大集合的情况下非常有用 (如包含很多元素的 terms filter).